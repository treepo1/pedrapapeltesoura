import resultsMenu from"./menus/results.js";import choiceMenu from"./menus/choice.js";import mainMenuTemplate from"./menus/main.js";import languageMenu from"./menus/language.js";const translations={eng:{loading:"And the result is...",computer:"Computer",play:"Play",title:"Rock Paper Scissors",rock:"Rock",paper:"Paper",scissors:"Scissors",win:"won!",lose:"lost!",you:"You",draw:"Draw!",playAgain:"Play again",score:"Your score",language:"Language",english:"English",portuguese:"Portuguese",chooseLanguage:"Choose a language",chooseYourWeapon:"Choose your weapon",timeToChoose:"You have {time} seconds to choose",backToMenu:"Back to menu"},br:{loading:"E o resultado é...",computer:"Computador",play:"Jogar",title:"Pedra, Papel, Tesoura",you:"Você",lose:"Perdeu!",rock:"Pedra",paper:"Papel",scissors:"Tesoura",win:"ganhou",draw:"Empate!",playAgain:"Jogar novamente",score:"Sua pontuação",language:"Idioma",english:"Inglês",portuguese:"Português",chooseLanguage:"Escolha um idioma",chooseYourWeapon:"Escolha sua arma",timeToChoose:"Você tem {time} segundos para escolher",backToMenu:"Voltar ao menu"}},translateName=(e,t)=>{if(console.log(e,t),Object.getOwnPropertyNames(translations).includes(t))return"You"===e||"Você"===e?(console.log(translations[t].you),translations[t].you):"Computer"===e||"Computador"===e?translations[t].computer:e;throw new Error("Invalid language")};function typeEffect(e,t){let a=0,s=setInterval(function(){t.innerHTML+=e[a],++a>=e.length&&clearInterval(s)},100)}class Game{constructor(){window.localStorage.getItem("players")?(console.log(JSON.parse(window.localStorage.getItem("players"))),this.players=JSON.parse(window.localStorage.getItem("players")).map(e=>new Player(e._name,e.computer,e._score))):this.players=[],window.localStorage.getItem("language")?this.language=window.localStorage.getItem("language"):this.language="br"}get language(){return this._language}set language(e){this._language=e,window.localStorage.setItem("language",e)}rules={rock:{scissors:!0,paper:!1},paper:{rock:!0,scissors:!1},scissors:{paper:!0,rock:!1}};async start(){var e,t;this.players.length<2&&(e=translations[this.language].you,t=translations[this.language].computer,this.addPlayer(e),this.addPlayer(t,!0)),window.localStorage.setItem("players",JSON.stringify(this.players)),await this.showMenu()}showMenu(){return new Promise((a,e)=>{Swal.fire({title:'<p id="titleMainMenu"></p>',html:mainMenuTemplate(this.players[0],this.players[1],translations[this.language].score),padding:"3em",showConfirmButton:!0,confirmButtonText:translations[this.language].play,showCancelButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,grow:"fullscreen",position:"center",allowEnterKey:!1,background:"white",width:"100%",height:"100%"}).then(e=>{if(e.isConfirmed){Swal.fire({title:translations[this.language].chooseLanguage,html:languageMenu(),padding:"3em",fullscreen:!0,showConfirmButton:!1,showCancelButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,background:"white",width:"100%"});for(const t of document.getElementById("language-menu__buttons").children)t.addEventListener("click",e=>{this.language=e.target.id;e=document.createElement("audio");e.src="assets/click.mp3",e.play(),this.play(),a()})}}),typeEffect(translations[this.language].title,document.getElementById("titleMainMenu"))})}addPlayer(e,t,a){this.players.push(new Player(e,t,a))}getWinner(){var e=this.players[0],t=this.players[1];return e.choice===t.choice?null:this.rules[e.choice][t.choice]?e:t}async play(){for(const s of this.players)try{await s.play()}catch(e){Swal.fire({title:translations[this.language].lose,html:"Foi de nelson!",width:800,showCancelButton:!0,cancelButtonText:translations[this.language].backToMenu,padding:"3em",confirmButtonText:translations[this.language].playAgain}).then(e=>{e.isConfirmed?this.play():this.showMenu()})}const t=this.getWinner(),a=this.players.find(e=>e!==t);Swal.fire({title:translations[this.language].loading,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,showConfirmButton:!1,showCancelButton:!1,background:"white",width:"100%",height:"100%"});var e=document.createElement("audio");e.src="assets/loadingResults.mp3",e.play(),setTimeout(()=>{var e;t?(t.score=t.score+1,t.computer||((e=document.createElement("audio")).setAttribute("src","assets/lost.mp3"),e.play()),Swal.fire({title:t.name+" "+translations[this.language].win,html:resultsMenu(t,a),width:800,showCancelButton:!0,cancelButtonText:translations[this.language].backToMenu,padding:"3em",confirmButtonText:translations[this.language].playAgain}).then(e=>{e.isConfirmed?this.play():this.showMenu()})):Swal.fire({title:translations[this.language].draw,html:resultsMenu(this.players[0],this.players[1]),width:800,showCancelButton:!0,cancelButtonText:translations[this.language].backToMenu,padding:"3em",confirmButtonText:translations[this.language].playAgain}).then(e=>{e.isConfirmed?this.play():this.showMenu()}),window.localStorage.setItem("players",JSON.stringify(this.players)),this.players.forEach(e=>e.choice=null)},4e3)}}class Player{constructor(e,t=!1,a=0){this.name=e,this.computer=t,this.score=a}get score(){return this._score}set score(e){this._score=e}get choice(){return this._choice}set choice(e){this._choice=e}get name(){return translateName(this._name,localStorage.getItem("language"))}set name(e){this._name=e}setChoice(e){this._choice=e}playComputer(){var e=Math.floor(3*Math.random());this._choice=["rock","paper","scissors"][e]}async playHuman(){return new Promise((n,l)=>{Swal.fire({title:translations[localStorage.getItem("language")].chooseYourWeapon,html:choiceMenu(),width:"100%",position:"center",grow:"fullscreen",timer:1e4,timerProgressBar:!0,showConfirmButton:!1,showCancelButton:!1,allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,didOpen:()=>{for(const o of document.getElementById("choiceMenu").children){var e=document.getElementById(o.id);e.addEventListener("mouseover",function(){this.src=`assets/${this.id}-hover.png`,this.style.cursor="pointer"}),e.addEventListener("mouseout",function(){this.src=`assets/${this.id}.png`}),e.addEventListener("click",function(){console.log(this.id),this.setChoice(o.id);var e=document.createElement("audio");e.setAttribute("src","assets/click.mp3"),e.play(),Swal.close(),n()}.bind(this))}const t=document.getElementById("timeLeft");let a=10;const s=setInterval(()=>{t.innerHTML=""+a,--a<0&&(clearInterval(s),l("Time is up"))},900)},didClose:()=>{l("Time is up")}})})}async play(){this.computer?this.playComputer():await this.playHuman()}}window.onload=async function(){var e=document.getElementById("playMusic"),e=(e.addEventListener("click",function(){document.getElementById("player")}),e.click(),localStorage.getItem("language"));e||localStorage.setItem("language","en"),document.title=translations[localStorage.getItem("language")].title,(new Game).start()};